<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap"
        rel="stylesheet">
    <title>Output</title>
</head>
<body style="background-color: #000000;">
    <nav class="navbar navbar-light bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <img src="img/feg-logo.png" alt="Far East Gaming logo" height="24"
                    class="d-inline-block align-text-top">
                <span id="navtitle">Postgame Graphics Generator</span>
            </a>
            <div id="actions">
                <a class="nav-item nav-link" href="#">Browser View</a>
                <a class="nav-item nav-link" href="#" id="download">Download</a>
            </div>
        </div>
    </nav>
    <div id="overlay"  >
        <div style="display: flex; justify-content: space-evenly;">
            <div id="left-info">
                <h1 id="overlay-title">ESTADÍSTICAS DE LA PARTIDA</h1>
                <div id="first-quadrant">
                    <div id="logos" style="display: flex; justify-content: space-around;">
                        <div id="winner-team" style="display: flex; flex-direction: column; align-items: center">
                            <div id="winner-logo">
                                <img src="uploads/<%=data.winnerTeamLogo%>" alt="Winner Team Logo" style="object-fit: contain; width: 100%; height: 100%;"/>
                            </div>
                            <p class="stats-title">GANADOR</p>
                            <p class="stats-result"><%=data.winnerTeamName%></p>
                        </div>
                        <div style="display: flex; flex-direction: column; justify-content: flex-end;">
                            <p class="stats-title"><%=data.matchPhase%></p></p>
                            <p id="vs">vs</p>
                            <p class="stats-title">Tiempo</p>
                            <p class="stats-result">
                                <%=data.duracion%>
                            </p>
                        </div>
                        <div id="loser-team" style="display: flex; flex-direction: column; align-items: center">
                            <div id="loser-logo">
                                <img src="uploads/<%=data.loserTeamLogo%>" alt="Loser Team Logo" style="object-fit: contain; width: 100%; height: 100%;"/>
                            </div>
                            <p class="stats-title">PERDEDOR</p>
                            <p class="stats-result"><%=data.loserTeamName%></p>
                        </div>
                    </div>
                </div>
                <hr class="left-line" style="border: 4px solid;">
                <div id="second-quadrant">
                    <p class="overlay-subtitle">Selecciones</p>
                    <div class="champions" >
                        <div id="winner-selections" class="champions-images">
                            <% for (var i=0; i < 5; i++ ) { %>
                                <img src="https://ddragon.leagueoflegends.com/cdn/11.23.1/img/champion/<%= data.ganador.seleccion[i].champion %>.png">
                            <% } %>
                        </div>
                        <div style="width: 10%"></div>
                        <div id="loser-selections" class="champions-images">
                            <% for (var i=0; i < 5; i++ ) { %>
                                <img src="https://ddragon.leagueoflegends.com/cdn/11.23.1/img/champion/<%= data.perdedor.seleccion[i].champion %>.png">
                            <% } %>
                        </div>
                    </div>
                </div>
                <hr class="left-line">
                <div id="third-quadrant">
                    <p class="overlay-subtitle">Prohibiciones</p>
                    <div class="champions">
                        <div id="winner-prohibition" class="champions-images">
                            <% for (var i=0; i < 5; i++ ) { %>
                                <img src="https://ddragon.leagueoflegends.com/cdn/11.23.1/img/champion/<%= data.ganador.prohibicion[i] %>.png">
                            <% } %>
                        </div>
                        <div style="width: 10%"></div>
                        <div id="loser-prohibitions" class="champions-images">
                            <% for (var i=0; i < 5; i++ ) { %>
                                <img src="https://ddragon.leagueoflegends.com/cdn/11.23.1/img/champion/<%= data.perdedor.prohibicion[i] %>.png">
                            <% } %>
                        </div>
                    </div>
                </div>
                <hr class="left-line">
                <div class="last-quadrants">
                    <p class="stats-result"><%=data.ganador.torre%></p>
                    <p class="overlay-subsubtitle" style="width: 30%">Torres</p>
                    <p class="stats-result"><%=data.perdedor.torre%></p>
                </div>
                <hr class="left-line">
                <div class="last-quadrants">
                    <p class="stats-result"><%=data.ganador.dragon%></p>
                    <p class="overlay-subsubtitle" style="width: 30%">Dragones</p>
                    <p class="stats-result"><%=data.perdedor.dragon%></p>
                </div>
                <hr class="left-line">
                <div class="last-quadrants">
                    <p class="stats-result"><%=data.ganador.baron%></p>
                    <p class="overlay-subsubtitle" style="width: 30%">Barón</p>
                    <p class="stats-result"><%=data.perdedor.baron%></p>
                </div>
                <hr class="left-line">
            </div>
            <div id="right-info">
                <div id="first-section">
                    <p class="overlay-subsubtitle">Estadísticas</p>
                    <div class="stats">
                        <p class="stats-result">
                            <%=data.ganador.kda.kills%> / <%=data.ganador.kda.deaths%> / <%=data.ganador.kda.assists%>
                        </p>
                        <p class="stats-title">K / D / A</p>
                        <p class="stats-result">
                            <%=data.perdedor.kda.kills%> / <%=data.perdedor.kda.deaths%> / <%=data.perdedor.kda.assists%>
                        </p>
                    </div>
                    <div class="stats">
                        <p class="stats-result">
                            <%=data.ganador.oro%>
                        </p>
                        <p class="stats-title">Oro total</p>
                        <p class="stats-result">
                            <%=data.perdedor.oro%>
                        </p>
                    </div>
                    <div class="stats">
                        <p class="stats-result">
                            <%=data.ganador.puntosDeVision%>
                        </p>
                        <p class="stats-title">Puntos de visión</p>
                        <p class="stats-result">
                            <%=data.perdedor.puntosDeVision%>
                        </p>
                    </div>
                </div>
                <hr class="right-line">
                <div id="second-section">
                    <p class="overlay-subtitle" style="margin: 0">Daño Total</p>
                    <div style="display: flex; justify-content: space-evenly;">
                        <div id="winner-damage" class="damage">
                            <% for (var i=0; i < 5; i++ ) { %>
                                <div class="damage-individual">
                                    <img src="https://ddragon.leagueoflegends.com/cdn/11.23.1/img/champion/<%= data.ganador.damage[i].championName %>.png">
                                    <div>
                                        <p class="stats-result"><%= data.ganador.damage[i].amount %>k</p>
                                    </div>
                                </div>
                            <% } %>
                        </div>
                        <div class="chart-container" style="position: relative; height:100vh; width:120vw">
                            <canvas id="danoTotalChart"></canvas>
                        </div>
                        <div id="loser-damage" class="damage">
                            <% for (var i=0; i < 5; i++ ) { %>
                                <div class="damage-individual">
                                    <div>
                                        <p class="stats-result"><%= data.perdedor.damage[i].amount %>k</p>
                                    </div>
                                    <img src="https://ddragon.leagueoflegends.com/cdn/11.23.1/img/champion/<%= data.perdedor.damage[i].championName %>.png">
                                </div>
                            <% } %>
                        </div>
                    </div>
                    
                </div>
                <hr class="right-line">
                <div id="third-section">
                    <p class="overlay-subtitle">Distribución de Oro</p>
                    <div style="display: flex; justify-content: space-evenly;">
                        
                        <div id="winner-damage" class="damage">
                            <% for (var i=0; i < 5; i++ ) { %>
                                <div class="damage-individual">
                                    <img src="https://ddragon.leagueoflegends.com/cdn/11.23.1/img/champion/<%= data.ganador.damage[i].championName %>.png">
                                    <div>
                                        <p class="stats-result">
                                            <%= data.ganador.goldDistribution[i].amount %>k
                                        </p>
                                    </div>
                                </div>
                                <% } %>
                        </div>
                        <div class="chart-container" style="position: relative; height:100vh; width:120vw">
                            <canvas id="distribucionOroChart"></canvas>
                        </div>
                        <div id="loser-damage" class="damage">
                            <% for (var i=0; i < 5; i++ ) { %>
                                <div class="damage-individual">
                                    <div>
                                        <p class="stats-result">
                                            <%= data.perdedor.goldDistribution[i].amount %>k
                                        </p>
                                    </div>
                                    <img
                                        src="https://ddragon.leagueoflegends.com/cdn/11.23.1/img/champion/<%= data.perdedor.damage[i].championName %>.png">
                                </div>
                                <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/FileSaver.min.js"></script>
    <script src="/html2canvas.min.js"></script>
    <script>
        var overlay = document.getElementById('overlay');

        // html2canvas(overlay, { 
        //     useCORS: true,
        //     backgroundColor: null,
        // })
        //     .then(canvas => {
        //         canvas.toBlob(blob => {
        //             saveAs(blob, 'myImage.png');
        //         });
        //     })
        //     .catch(error => {
        //         console.error('oops, something went wrong!', error);
        //     });
    </script>
</body>

<script
src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js">
</script>
<script>
    
    function horizontalBarChart(ctx, data1, data2){
        var data = {
            labels: ["", "", "", "", ""],
            datasets: [{
                label: "winner",
                backgroundColor: "rgba(54, 162, 235, 0.2)",
                borderColor: "rgb(54, 162, 235)",
                borderWidth: 2,
                data: data1,
                }, {
                label: "loser",
                backgroundColor: "rgba(255,99,132,0.2)",
                borderColor: "rgba(255,99,132,1)",
                borderWidth: 2,
                data: data2,
                },
            ]
            };
        const myChart = new Chart(ctx, {
            type: 'horizontalBar',
            stacked: true,
            data: data,
            options: {
                legend: {
                    display: false
                },
                scales: {
                yAxes: [{
                    stacked: true
                }],
                xAxes: [{
                        display: false
                    }]
                }
            }
        });
    }

    // Dano Total
    const ctx1 = document.getElementById('danoTotalChart');
    const danoData1 = [
    -Math.abs(parseInt(`<%= data.ganador.damage[0].amount %>`)),
    -Math.abs(parseInt(`<%= data.ganador.damage[1].amount %>`)),
    -Math.abs(parseInt(`<%= data.ganador.damage[2].amount %>`)),
    -Math.abs(parseInt(`<%= data.ganador.damage[3].amount %>`)),
    -Math.abs(parseInt(`<%= data.ganador.damage[4].amount %>`)) 
    ]
    const danoData2 = [
        parseInt(`<%= data.perdedor.damage[0].amount %>`), 
        parseInt(`<%= data.perdedor.damage[1].amount %>`), 
        parseInt(`<%= data.perdedor.damage[2].amount %>`), 
        parseInt(`<%= data.perdedor.damage[3].amount %>`), 
        parseInt(`<%= data.perdedor.damage[4].amount %>`)
    ]
    //Distribucion oro
    const ctx2 = document.getElementById('distribucionOroChart');
    const oroData1 = [
    -Math.abs(parseInt(`<%= data.ganador.goldDistribution[0].amount %>`)),
    -Math.abs(parseInt(`<%= data.ganador.goldDistribution[1].amount %>`)),
    -Math.abs(parseInt(`<%= data.ganador.goldDistribution[2].amount %>`)),
    -Math.abs(parseInt(`<%= data.ganador.goldDistribution[3].amount %>`)),
    -Math.abs(parseInt(`<%= data.ganador.goldDistribution[4].amount %>`)) 
    ]
    const oroData2 = [
        parseInt(`<%= data.perdedor.goldDistribution[0].amount %>`), 
        parseInt(`<%= data.perdedor.goldDistribution[1].amount %>`), 
        parseInt(`<%= data.perdedor.goldDistribution[2].amount %>`), 
        parseInt(`<%= data.perdedor.goldDistribution[3].amount %>`), 
        parseInt(`<%= data.perdedor.goldDistribution[4].amount %>`)]
    
    horizontalBarChart(ctx1, danoData1, danoData2)
    horizontalBarChart(ctx2, oroData1, oroData2)
    
</script>

</html>
